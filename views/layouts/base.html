<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{{ template "title" . }} - Tdispo</title>
    <script src="//unpkg.com/htmx.org@1.6.0"></script>
    <script src="//unpkg.com/alpinejs@3.x.x" defer></script>
    <link rel="icon" href="/static/favicon.ico">
  </head>

  <body hx-boost="true">
    {{ template "layouts/header" . }}
    {{ template "layouts/nav" . }}
    {{ template "layouts/flash" . }}

    <main>
      {{ template "main" . }}
    </main>

    <script>
      document.body.addEventListener('htmx:beforeSwap', function(event) {
        var status = event.detail.xhr.status

        // allow to swap on certain http codes when
        // the error is rendered from the server 
        if ([422, 409].includes(status)) {
          event.detail.shouldSwap = true
        }

        // flash if other error
        if (!event.detail.shouldSwap && status >= 400 && status < 600) {
          document.getElementById("flash").innerHTML = '<p>{{ "An error has occurred" | translate }}</p>'
        }
      })

      // inject csrf token in htmx requests
      document.body.addEventListener('htmx:configRequest', function(event) {
        event.detail.headers['X-CSRF-Token'] = '{{ .CSRFToken }}';
      })
    </script>
  </body>
</html>
